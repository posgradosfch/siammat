<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<ui:composition template="/WEB-INF/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>
        <script type="text/javascript">
            function start() {
                PF('statusDialog').show();
            }

            function stop() {
                PF('statusDialog').hide();
            }
        </script>
    </h:head>
    <ui:define name="content">
        <h:form>
            <p:panel header="Listado de materias">
                <p:messages autoUpdate="true" closable="true" />
                <p:panel header="Criterios de búsqueda" toggleTitle="Minimizar" toggleable="true" toggleOrientation="vertical">
                    <p:panelGrid columns="2" class="ui-panelgrid-blank" id="filtros">
                        <p:outputLabel value="Universidad" for="universidad"/>
                        <p:selectOneMenu id="universidad" value="#{materiaListBean.sfUniversidad.value}"
                                         valueChangeListener="#{escuelaListBean.onSelectUniversidad}" 
                                         requiredMessage="Debe seleccionar la Universidad">
                            <p:ajax update="facultades" />
                            <f:selectItem itemLabel="Seleccione"/>
                            <f:selectItems value="#{escuelaListBean.universidadList}" var="universidad" itemLabel="#{universidad.nombreCompleto}" itemValue="#{universidad.idUniversidad}"/>
                        </p:selectOneMenu>

                        <p:outputLabel value="Facultad" for="facultades" />
                        <p:selectOneMenu id="facultades" value="#{materiaListBean.sfFacultad.value}" valueChangeListener="#{materiaListBean.onSelectFacultad}"> 
                            <p:ajax update="carreras" />
                            <f:selectItem itemLabel="Seleccione"/>
                            <f:selectItems value="#{escuelaListBean.facultadList}" var="facultad" itemLabel="#{facultad.nombreCompleto}" itemValue="#{facultad.idFacultad}"/>
                        </p:selectOneMenu>
                        <p:outputLabel value="Carrera" for="carreras" />
                        <p:selectOneMenu id="carreras" value="#{materiaListBean.sfCarrera.value}" required="true" requiredMessage="Seleccione una carrera"> 
                            <f:selectItem itemLabel="Seleccione"/>
                            <f:selectItems value="#{materiaListBean.carreraList}" var="carrera" itemLabel="#{carrera.nombre}" itemValue="#{carrera.idCarrera}"/>
                        </p:selectOneMenu>
                        <p:outputLabel value="Plan de estudio" for="planEstudio" />
                        <p:inputText id="planEstudio" value="#{materiaListBean.sfPlanEstudio.value}" maxlength="4"/>
                        <p:outputLabel value="Código" />
                        <p:inputText   value="#{materiaListBean.sfCodigo.value}" />
                    </p:panelGrid>
                </p:panel>
                
                <br />

                <p:commandButton update="lst filtros" value="Buscar" actionListener="#{materiaListBean.onSearch()}"/>
                <p:commandButton update="lst" value="Nuevo" actionListener="#{materiaListBean.onNew()}" immediate="true">   
                    <p:ajax update="lst" event="dialogReturn" listener="#{materiaListBean.onSearch()}" />
                </p:commandButton>
                <p:dataTable id="lst" var="materia" value="#{materiaListBean.items}" rows="10"
                             paginator="true" paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15">
                    <p:column headerText="Código" style="width: 50px">
                        <p:outputLabel value="#{materia.codigo}" />
                    </p:column>
                    <p:column headerText="Nombre">
                        <p:outputLabel value="#{materia.nombre}" />
                    </p:column>
                    <p:column headerText="Plan Estudio" style="width: 35px">
                        <p:outputLabel value="#{materia.planEstudio}" />
                    </p:column>
                    <p:column headerText="U.V" style="width: 20px">
                        <p:outputLabel value="#{materia.unidadesValorativas}" />
                    </p:column>
                    <p:column headerText="Acciones" style="width: 90px">
                        <p:commandButton update="lst" icon="ui-icon-pencil" actionListener="#{materiaListBean.onEdit(materia)}">
                            <p:ajax update="lst" event="dialogReturn" />
                        </p:commandButton>    
                        <p:commandButton update="lst" icon="ui-icon-trash" actionListener="#{materiaListBean.onRemove(materia)}">
                            <p:confirm header="Confirmar" message="Desea eliminar registro" icon="ui-icon-alert" />
                            <p:ajax update="lst" event="dialogReturn" />
                        </p:commandButton>
                        <p:commandButton ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" title="Descargar Programa" icon="ui-icon-arrowthick-1-s" rendered="#{materia.archivoPlanEstudio!=null}">
                            <p:fileDownload value="#{materia.planEstudioFile}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:panel>
            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
            </p:confirmDialog>
        </h:form>
    </ui:define>
</ui:composition>
